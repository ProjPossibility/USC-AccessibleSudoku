<html>
<head>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script type="text/javascript">
(function($){
Object.prototype.clone = function () {
	var o = new Object();
	for (var property in this)
	{
		o[property] = typeof (this[property]) == 'object' ? this[property].clone() : this[property];
	}
	return o;
}

Array.prototype.clone = function () {
	var a = new Array();
	for (var property in this) 
	{
		a[property] = typeof (this[property]) == 'object' ? this[property].clone() : this[property];
	} 
	return a;
}

var Sudoku = function(){
	this.grid=[];
	this.ans=[];
	for(var row = 0; row < 9; row++)
	{
		var cols = [];
		for(var col = 0; col < 9; col++)
			cols[col] = 0;
		this.grid[row] = cols;
		this.ans[row]=cols;
	}
};
Sudoku.prototype.checkRowConflict=function(row,col){
	var value = this.grid[row][col];
	
	if(value == 0)
		return false;
		
	for(var i = 0; i < 9; i++)
	{
		if(i != row && this.grid[i][col] == value) 
		{
			return true;
		}
	}
return false;
};
Sudoku.prototype.checkColConflict=function(row,col){
var value = this.grid[row][col];
	
	if(value == 0)
		return false;
		
	for(var i = 0; i < 9; i++)
	{
		if(i != col && this.grid[row][i] == value)
		{
			return true;				
		}
	}
return false;
};
Sudoku.prototype.checkBoxConflict=function(row,col){
	var mgX = Math.floor(col / 3);
	var mgY = Math.floor(row / 3);
	
	var startCol = mgX * 3;
	var startRow = mgY * 3;
	
	var endCol = (mgX + 1) * 3;
	var endRow = (mgY + 1) * 3;
	
	var numbers = [];
	for(var r = startRow; r < endRow; r++)
	{
		for(var c = startCol; c < endCol; c++)
		{
			var value = this.grid[r][c];
			if(value == 0)
				continue;
				
			if(jQuery.inArray(value, numbers)!==-1)
				return false;
				
			numbers.push(value);	
		}
	}
	return true;
};
Sudoku.prototype.genSudoku=function(){
	var cellNumbers = [];
	for(var i = 0; i < 81; i++)
	{
		cellNumbers[i] = [1,2,3,4,5,6,7,8,9];
	}
	for(var i = 0; i < 81; i++)
	{	
		var found = false;
		var row = Math.floor(i / 9);
		var col = i - (row * 9);
		var val_found=false;
		if(i>=0)
			{
			while(cellNumbers[i].length > 0)
			{
				var rnd = Math.floor(Math.random() * cellNumbers[i].length);
				var num = cellNumbers[i].splice(rnd, 1)[0];
				this.grid[row][col]=num;
				var conflict_flag=false;
				if(this.checkRowConflict(row,col) || this.checkColConflict(row,col) || !this.checkBoxConflict(row,col))
				{
					conflict_flag=true;
					val_found=false;
				}
				if(conflict_flag)
				{
					this.grid[row][col]=0;
					val_found=false;
					continue;
				}
				else
				{
					val_found=true;
					break;	
				}
			}
			if(!val_found)
			{
				cellNumbers[i] = [1,2,3,4,5,6,7,8,9];
				i-=2;	
			}
		}
	}
	//alert("grid is"+this.grid);
	this.cull(50);
};
Sudoku.prototype.cull=function(amount){
		this.ans=this.grid.clone();
		var cells = [];
		for(var i = 0; i < 81; i++)
			cells.push(i);
			
		for(var i = 0; i < amount; i++)
		{
			var rnd = Math.floor(Math.random() * cells.length);
			var value = cells.splice(rnd, 1);
			var row = Math.floor(value / 9);
			var col = value - (row * 9);
			this.grid[row][col]=0;
		}
}
Sudoku.prototype.toString=function(){
	var str = '';
	for(var row = 0; row < 9; row++)
	{
		for(var col = 0; col < 9; col++)
		{
			str += this.grid[row][col];
		}
		str += "<br />";
	}
	return str;
};

var Speech = function(){
		
};

Speech.prototype.speak=function(toSpeak,ind,old_time){
	last_index=ind;
	if(typeof toSpeak!=="string")
		return;
	
	if(toSpeak.length<=0)
		return;

			if(last_index<toSpeak.length)
			{
				var new_last_index=0;
				var chunk ="";
				var left = toSpeak.length-last_index;
				left=left>100?100:left;
				//alert("chunking from "+last_index);
				chunk= toSpeak.substr(last_index,left);
				new_last_index=chunk.lastIndexOf(' ');
				if(new_last_index===-1 || new_last_index===0)
					new_last_index=chunk.length;
				else
					new_last_index=new_last_index;
				if(chunk.length<=100)
					new_last_index=chunk.length;
				var chunky= chunk.slice(0,new_last_index);
				time=((chunky.split(' ').length)*1000)/2.2;
				time+=old_time;
				setTimeout(function(){
					$("#ifrm").remove();
					$('body').append("<iframe id='ifrm'>");
					$("#ifrm").get(0).contentWindow.location.href = 'http://translate.google.com/translate_tts?tl=ch&q='+chunky;
					$("#ifrm").attr('frameBorder', '0');
					$("#ifrm").attr('width', '0');
					$("#ifrm").attr('height', '0');
				},old_time);
				last_index=(last_index+chunk.length)-(chunk.length-new_last_index);
				old_time=time;
				this.speak(toSpeak,last_index,old_time);
			}
};
var newSudoku = new Sudoku();
newSudoku.genSudoku();
document.write(newSudoku.toString());
var newSpeech = new Speech()
newSpeech.speak("Hi, Welcome to worlds most accessible sudoku. Please press space bar to skip the instructions. You can use arrow keys to move around in the puzzle.Please use keys z, x and c for knowing the values of rows, columns and blocks.",0,0);
//newSpeech.speak("hello world",0,0);
})(jQuery)
</script>
</head>
</html>